# Generate lesson JSON from news and open a PR automatically.

tasks:
  - name: Ingest (index pages → lesson JSON)
    run: |
      mcp:ingest.ingest_from_index --index_url "https://www.bbc.co.uk/news" --selector "a.gs-c-promo-heading" --language "en" --max_links 6 > .tmp_bbc.json
      mcp:ingest.ingest_from_index --index_url "https://www.aljazeera.com/latest/" --selector "a.u-clickable-card__link" --language "en" --max_links 4 > .tmp_aj.json
      mkdir -p content/news
      python - <<'PY'
      import json, time, os
      for f in [".tmp_bbc.json",".tmp_aj.json"]:
          d = json.load(open(f))
          for item in d.get("lessons",[]):
              slug = item["id"]
              p = f"content/news/{int(time.time())}_{slug}.json"
              with open(p,"w",encoding="utf-8") as w: json.dump(item,w,ensure_ascii=False,indent=2)
              print("WROTE", p)
      PY

  - name: Commit & PR
    run: |
      mcp:gitops.git_create_branch --name "content-ingest"
      mcp:gitops.git_commit_all --message "content: ingest news → lesson JSON"
      mcp:gitops.git_push_branch --name "content-ingest"
      mcp:gitops.git_open_pr --title "Content: fresh lessons via MCP ingest" --base "${GIT_BASE:-main}"

options:
  auto_commit: false